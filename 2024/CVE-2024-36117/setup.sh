#!/bin/bash

# https://reposilite.com/guide/jar

# Switch to root and update the package list
sudo su root
cd /root
sudo apt update

# Setup the test workspace by cloning the official github repo
git clone https://github.com/dzikoysk/reposilite/

# Move all the contents from the workspace directory into the root directory
mv /root/reposilite/reposilite-test/workspace/* /root/

# Download the Reposilite v3.5.10 JAR file from the official website
wget https://maven.reposilite.com/releases/com/reposilite/reposilite/3.5.10/reposilite-3.5.10-all.jar

# Install Java 11
sudo apt install -y openjdk-11-jdk


# Configure Reposilite as a service
sudo bash -c 'cat << EOF > /etc/systemd/system/reposilite.service
[Unit]
Description=Reposilite Service
After=network.target

[Service]
User=root
Group=root
WorkingDirectory=/root
ExecStart=/usr/bin/java -Xmx32M -jar reposilite-3.5.10-all.jar
Restart=always
RestartSec=5
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF'

# Reload systemd to recognize the new service
sudo systemctl daemon-reload

# Start the Reposilite service
sudo systemctl start reposilite

# Enable the Reposilite service to start on boot
sudo systemctl enable reposilite

# Notify the user that the installation and configuration has been successful.
echo "Reposilite has been installed and configured as a systemd service."

