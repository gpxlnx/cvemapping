# CVE-2024-55210

I have identified a vulnerability in the way the MFA module works on Protheus software from TOTVS. The validation of the OTP token is sent via WebSocket and is validated in the client-side. So, it is possible to manipulate the websocket message, turning the content of parameter "isValidToken" to true.
As the problem is related to MFA, it is a requirement that the attacker is already logged in on some victim account. Anyways, this vulnerability completely turns off the MFA protection.

This is the WebSocket flow:
MFA message 1 (client -> server):
[...]imfaValidCode000000
![image](https://github.com/user-attachments/assets/df3ade2b-0568-4c28-bd52-e988dd5c37bb)


MFA message 2 (server -> client):
\ACKMAIN_THREADOOOOOO193552e55df
![image](https://github.com/user-attachments/assets/a986c2a7-abf7-490c-90a6-aba18f0c60ed)


MFA message 3 (server -> client):
[...]MAIN_THREAD!AmfaValidCode{"isValidToken":false}
![image](https://github.com/user-attachments/assets/c0a03e7f-0e19-425e-819f-96b2fc97be5b)


So, whatever is the response from server, if I change the value of isValidToken to true, the MFA authentication will be allowed.
![image](https://github.com/user-attachments/assets/58a91450-905d-4864-a819-1edd85412680)


Check this DEMO video showing how simple is to exploit it:
https://github.com/user-attachments/assets/9d141940-dfb2-42ae-8cdb-08cf7775c81d





