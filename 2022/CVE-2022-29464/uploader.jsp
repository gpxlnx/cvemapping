<%@ page import="java.io.*" %>
<%@ page import="javax.servlet.http.*" %>
<%@ page import="javax.servlet.*" %>

<!DOCTYPE html>
<html>
<head>
    <title>Uploader JSP</title>
</head>
<body>
    <h1>Subir archivo</h1>
    <form action="uploader.jsp" method="post" enctype="multipart/form-data">
        <label for="archivo">Seleccionar archivo:</label>
        <input type="file" name="archivo" id="archivo" required>
        <button type="submit">Subir</button>
    </form>

    <%
        // Ruta de la carpeta actual
        String rutaActual = application.getRealPath(".");
        out.println("<p>Ruta actual: " + rutaActual + "</p>");

        // Procesar la solicitud si es un POST
        if ("POST".equalsIgnoreCase(request.getMethod())) {
            try {
                Part parteArchivo = request.getPart("archivo");
                
                if (parteArchivo != null) {
                    String nombreArchivo = parteArchivo.getSubmittedFileName();

                    // Guardar el archivo en la ruta actual
                    File archivoSubido = new File(rutaActual + File.separator + nombreArchivo);
                    try (InputStream entrada = parteArchivo.getInputStream();
                         FileOutputStream salida = new FileOutputStream(archivoSubido)) {
                        byte[] buffer = new byte[1024];
                        int bytesLeidos;
                        while ((bytesLeidos = entrada.read(buffer)) != -1) {
                            salida.write(buffer, 0, bytesLeidos);
                        }
                    }

                    out.println("<p>Archivo subido exitosamente a: " + archivoSubido.getAbsolutePath() + "</p>");
                } else {
                    out.println("<p>No se seleccionó ningún archivo.</p>");
                }
            } catch (Exception e) {
                out.println("<p>Error al subir el archivo: " + e.getMessage() + "</p>");
                e.printStackTrace(out);
            }
        }
    %>
</body>
</html>
