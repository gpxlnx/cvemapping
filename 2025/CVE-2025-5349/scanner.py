#!/usr/bin/env python3
import requests
import argparse

def check_vuln(host, port, use_https):
    protocol = 'https' if use_https else 'http'
    url = f"{protocol}://{host}:{port}/cgi/cgi_bin/api_mgr"
    try:
        r = requests.get(url, verify=False, timeout=5)
    except Exception as e:
        print(f"[-] Erro conectando a {url}: {e}")
        return False

    if r.status_code == 200 and ('<title>NetScaler' in r.text or 'practice' in r.text):
        print(f"[+] {host}:{port} parece vulnerável! (HTTP 200 e painel detectado)")
        return True
    else:
        print(f"[-] {host}:{port} não parece vulnerável (status {r.status_code}).")
        return False

def main():
    parser = argparse.ArgumentParser(
        description="Detecção simples de CVE-2025-5349 em NetScaler ADC/Gateway"
    )
    parser.add_argument("targets", nargs="+", help="IPs ou hosts a verificar")
    parser.add_argument("-p", "--port", type=int, default=80, help="Porta HTTP (default: 80)")
    parser.add_argument("--https", action="store_true", help="Usa HTTPS na verificação")
    args = parser.parse_args()

    for tgt in args.targets:
        check_vuln(tgt, args.port, args.https)

if __name__ == "__main__":
    main()
